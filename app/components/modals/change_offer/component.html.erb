<div class="c-modal-overlay js-modal">
    <div class="c-modal">
        <div class="c-modal__scroll">
            <div class="c-modal__scroll__content">
                <button class="c-modal__close-btn js-close-modal">
                    <span class="o-close-icon"></span>
                </button>
                <div class="c-modal__header">
                    <div class="c-modal__header__title">
                        <span class="o-edit-icon--green"></span>
                        <span>Muuda pakkumist</span>
                    </div>
                    <div class="c-modal__header__subject">
                        <span class="c-modal__header__subject__title"><%= @auction.domain_name %></span>
                        <span class="o-io-icon o-io-icon--bg-blue"></span>
                    </div>
                    <div class="c-modal__header__desc">
                        <span>Domeeni eelisõiguse registreerimise pakkumine</span>
                        <span data-tooltip="Domeeni eelisõiguse registreerimise pakkumine."
                              class="o-info-icon js-tippy"></span>
                    </div>
                </div>

                    <div class="c-modal__main">
                        <div class="c-modal__grid">
                            <div class="c-modal__main__info">
                                <span>Vähim võimalik pakkumus</span>
                                <h3 class="u-h2 u-m-none"><span id="mini"><%= number_with_precision(Money.from_amount(@auction.min_bids_step.to_f, Setting.find_by(code: 'auction_currency').retrieve,  precision: 2)) %></span></h3>
                            </div>
                            <div class="c-modal__main__info c-modal__main__info--black">
                                <strong>Hetke parim pakkumus</strong>
                                <h3 class="u-h2 u-m-none">
                                    <span id="current_<%= @auction.id %>_price">
                                        <%# english_auction_presenter = EnglishBidsPresenter.new(@auction) %>
                                        <%#= english_auction_presenter.current_price(auction.currently_winning_offer, current_user) %>
                                        <%= current_price(@offer, @current_user) %>
                                    </span>
                                </h3>
                                <span>Keegi pole veel pakkunud</span>
                            </div>
                        </div>

                        <%= form_with model: @autobider, url: autobider_url do |f| %>
                            <div class="c-modal__grid u-align-center u-flex-wrap u-mt-24 u-mt-48-l">
                                <%= f.hidden_field :domain_name, value: offer.auction.domain_name %>
                                <%= f.hidden_field :user_id, value: offer.user_id %>

                                <label>Automaatpakkuja lagi</label>
                                <div class="c-modal__col">
                                    <%# <input class="" name="" value="0.00"/> %>
                                    <%= f.number_field :price, min: 0.0, step: 0.01, value: @autobider.price, disabled: @auction.finished? ? true : false %>
                                </div>
                                <div class="c-modal__col">
                                    <div class="u-flex u-flex-wrap u-flex-gap-12">
                                        <label class="o-checkbox" for="checkbox">
                                            <input type="checkbox" id="checkbox"/>
                                            <div class="o-checkbox__slider round"></div>
                                        </label>
                                        <span class="u-word-nowrap">Automaatpakkuja: <strong>Jah</strong></span>
                                    </div>
                                </div>
                            </div>
                        <% end %>

                        <%= form_with model: @offer, url: url, id: 'english_offer_form', data: { turbo: false },
                            data: { controller: 'autotax-counter', autotax_counter_template_value: t('english_offers.price_with_wat_template'),
                            autotax_counter_tax_value: "#{offer.billing_profile.present? ? offer.billing_profile.vat_rate : 0.0 }",
                            autotax_counter_defaulttemplate_value: t('offers.price_is_without_vat')} do |f| %>

                            <%= f.hidden_field :user_id, value: offer.user_id %>
                            <%= f.hidden_field :auction_id, value: offer.auction_id %>
      
                            <div class="c-modal__grid u-flex-wrap u-mt-24 u-mt-48-l">
                                <div class="c-modal__col">
                                    <label>Pakkumus</label>
                                    <%# <input class="" name="" value="0.00"/> %>
                                    <%#= number_field_tag 'offer_price', name: "offer[price]", min: 0, step: "0.01" %>
                                    <%# # , disabled: offer_disabled, data: { action: 'autotax-counter#count' } %>

                                    <%#= f.number_field :price, step: "0.01", min: 0.0, value: @auction.min_bids_step, disabled: offer_disabled?, data: { action: 'autotax-counter#count' } %>
                                    <span id="offer_<%=offer.auction.id%>_form">
                                        <%= component 'modals/change_offer/number_form_field', offer_value: @auction.min_bids_step.to_f, offer_disabled: @auction.finished? %>
                                    </span>
                                    <span class="c-modal__input-desc">Pakkumus peab olema vähemalt 5.00</span>
                                </div>
                                <div class="c-modal__col">
                                    <label>Kokku</label>
                                    <%# <span class="c-modal__calculation"><strong>264</strong> (+ 20% käibemaks)</span> %>
                                    <span class="c-modal__calculation" data-autotax-counter-target='result'>
                                        <% if offer.billing_profile.present? %>
                                            <%= t('offers.price_with_wat', price: (@auction.min_bids_step.to_f * offer.billing_profile.vat_rate.to_f).to_f + @auction.min_bids_step.to_f, tax: offer.billing_profile.vat_rate * 100)  %>
                                        <% else %>
                                            <%= t('offers.price_is_without_vat') %>
                                        <% end %>
                                    </span>
                                </div>
                            </div>
                            <div class="c-modal__select u-mt-24 ">
                                <%= f.label :billing_profile, t('.bidder') %>
                                <%= f.select :billing_profile_id,
                                            billing_profiles = BillingProfile.where(user_id: offer.user_id).collect { |b| [b.name, b.id, {'data-vat-rate' => b.vat_rate}] },
                                            {},
                                            class: billing_profiles.size == 1 ? "disabled" : "",
                                            data: { action: 'change->autotax-counter#updateTax' } %>
                                            <%# data: { action: 'change->autotax-counter#updateTax' }  %>
                            </div>
                            <a class="c-modal__link c-modal__link--first-col" href="#">Uus arve aadress</a>
                        <% end %>
                    </div>

                <div class="c-modal__footer">
                    <div class="c-modal__footer__col">
                        <button class="c-btn c-btn--ghost">Tagasi</button>
                    </div>
                    <div class="c-modal__footer__col">
                        <button class="c-btn c-btn--ghost c-btn--icon">
                            <span class="o-delete-icon"></span>
                        </button>
                        <%= submit_tag t(:submit), class: "c-btn c-btn--green", id: 'bid_action', form: 'english_offer_form', data: { turbo: false } %>
                    </div>
                </div>
                
                <% if @captcha_required %>
                    <div class="field">
                    <br>
                    <%= recaptcha_tags id: "english_offer" %>
                    </div>
                <% end %>
            </div>
        </div>
    </div>
</div>