<%= turbo_stream_from "auctions" %>

<% content_for :hero do %>
    <div class="hero green">
        <h1><%= t('.title') %></h1>
    </div>
<% end %>

<%= render 'top_grid' %>

<div class="features-grid top narrow grey">
    <div class="ui search">
        <div class="ui massive input icon">
            <%#= form_with(url: auctions_path, local: true, method: :get) do |f| %>
            <%= form_with url: auctions_path, 
                    method: :get,
                    data: { controller: 'debounce',
                            debounce_target: 'form',
                            turbo_action: "advance",
                            turbo_frame: "auction_list",
                            action: 'input->debounce#search' 
                            } do |f| %>
                <div class="ui input icon">
                    <%= f.text_field :domain_name, placeholder: t('search_by_domain_name') %>
                </div>

                <%= f.button(class: "ui icon primary button") do %>
                    <i aria-hidden="true" class="arrow right icon"></i>
                <% end %>
            <% end %>
        </div>
            <%= daily_summary_link %>
    </div>
</div>

<div class="u-container">
    <div class="margin-block narrow">
        <div class="grid one column">
            <%= turbo_frame_tag "auction_list" do %>
            <div class="column">
                <table class="ui table selectable celled center aligned" id="auctions-table">
                    <thead>
                        <tr>
                            <th>
                                <%= t('auctions.domain_name') %>
                                <%#= order_buttons('participant_auction_decorators.domain_name') %>
                                <%= sort_link_to "", "domain_name" %>
                            </th>
                            <th>
                                <%= t('auctions.ends_at') %>
                                <%#= order_buttons('participant_auction_decorators.ends_at') %>
                                <%= sort_link_to "", "ends_at" %>
                            </th>
                            <th>
                                <%= t('auctions.auction_type') %>
                                <%#= order_buttons('participant_auction_decorators.platform') %>
                                <%= sort_link_to "", "platform" %>
                            </th>
                            <th class="auctions-table-cell-name-no-mobile">
                                <%= t('auctions.your_current_price') %>
                                <%#= order_buttons('participant_auction_decorators.users_offer_cents') %>
                                <%= sort_link_to "", "users_offer_cents" %>
                            </th>
                            <th class="auctions-table-cell-name-no-mobile center aligned five wide"><%= t('auctions.offer_actions') %></th>
                        </tr>
                    </thead>

                    <%= tag.tbody id: "bids" do %>
                        <% @auctions.each do |auction| %>
                            <%= render partial: 'auction', locals: { auction: auction, q_user: current_user } %>
                        <% end %>
                    <% end %>
                </table>
            </div>

            <div class="column">
                <% if @pagy.pages > 1 %>
                    <div class="footer">
                        <%== pagy_nav(@pagy) %>
                    </div>
                <% end %>
            </div>
            <% end %>
        </div>
    </div>
</div>
