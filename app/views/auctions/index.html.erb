<%= component 'common/hero', title: 'Oksjonikeskkond' %>
<%= turbo_stream_from 'auctions' %>
<!-- Cards -->
<%= component 'pages/auction/cards' %>
<!-- Cards -->
<!-- Table -- Sortable -->
<div class="o-container">
  <div class="c-table c-table--sortable" data-controller="english-offers" 
        data-action="turbo:before-stream-render@document->english-offers#beforeStreamRender"
    data-english-offers-user-id-value="<%= current_user&.id %>"
    data-english-offers-bid-text-value="<%= t('auctions.bid') %>"
    data-english-offers-participate-text-value="<%= t('auctions.participate') %>"
    data-english-offers-english-text-value="<%= t('auctions.english') %>"
    data-english-offers-blind-text-value="<%= t('auctions.blind') %>">
    <%= form_with url: auctions_path, 
                    method: :get, data: { controller: 'form--debounce form--filter',
                        form__debounce_target: 'form',
                        form__filter_target: 'form',
                        turbo_action: "advance",
                        turbo_frame: "auction_list",
                        action: 'input->form--debounce#search' 
                        } do |f| %>
      <div class="c-table__filters">
        <div class="c-table__filters__btns" data-controller="">
          <%= f.radio_button :type, 'all', class: "js-table-filter-btn", checked: true, style: 'visibility: hidden; position: absolute;', id: 'filter_all_button', data: { form__filter_target: 'button' } %>
          <%= f.label :type_all, "k천ik", class: "c-table__filters__btn is-active js-table-filter-btn", style: 'cursor: pointer;', for: 'filter_all_button', data: { form__filter_target: 'label', action: "click->form--filter#click" } %>
          <%= f.radio_button :type, 'english', class: "js-table-filter-btn", style: 'visibility: hidden; position: absolute;', id: 'filter_IO_button', data: { form__filter_target: 'button' } %>
          <%= f.label :type_english, class: "c-table__filters__btn js-table-filter-btn", style: 'cursor: pointer;', for: 'filter_IO_button', data: { form__filter_target: 'label', action: "click->form--filter#click" } do %>
            <span class="o-io-icon"></span>
            <span class="u-hidden-m"> inglise oksjon</span>
          <% end %>
          <%= f.radio_button :type, 'blind', class: "js-table-filter-btn", style: 'visibility: hidden; position: absolute;', id: 'filter_PO_button', data: { form__filter_target: 'button' } %>
          <%= f.label :type_blind, class: "c-table__filters__btn js-table-filter-btn", style: 'cursor: pointer;', for: 'filter_PO_button', data: { form__filter_target: 'label', action: "click->form--filter#click" } do %>
            <span class="o-po-icon"></span>
            <span class="u-hidden-m"> pime oksjon</span>
          <% end %>
        </div>
        <div class="c-table__filters__search">
          <%= f.search_field :domain_name, value: params[:domain_name], placeholder: t('search_by_domain_name'), class: 'c-table__search__input js-table-search-dt' %>
        </div>
        <div class="c-table__filters__more">
          <a href="#" class="c-btn c-btn--ghost">Telli teavitused</a>
        </div>
        <div class="c-auctions__legend">
          <div><span class="o-io-icon o-icon--sm"></span>
            inglise oksjon
          </div>
          <div><span class="o-po-icon o-icon--sm"></span>
            pime oksjon
          </div>
        </div>
      </div>
    <% end %>
    <%= turbo_frame_tag "auction_list" do %>
      <table class="js-table-dt dataTable no-footer" data-controller='table--sort'>
        <thead>
          <tr>
            <th class='sorting'>Domeeninimi</th>
            <th class='sorting'>T체체p</th>
            <th class='sorting'>L천pp</th>
            <th class='sorting'>Pakkumus</th>
            <th class='sorting'>Pakkumuse omanik</th>
            <th class="u-text-left u-text-center-l">Pakkumustegevused</th>
          </tr>
        </thead>
        <%= tag.tbody id: "bids", class: 'contents' do %>
          <% @auctions.uniq.each do |auction| %>
            <%= render partial: 'auction', locals: { auction: auction, user: current_user } %>
          <% end %>
        <% end %>
      </table>
    <% end %>
  </div>

  <div class="u-text-center u-mt-40">
    <% if @pagy.pages > 1 %>
      <div class="dataTables_filter">
        <%== pagy_nav(@pagy) %>
      </div>
    <% end %>
  </div>

  <div class="u-text-center u-mt-40">
    <%= link_to t('auctions.all_list'), auctions_path(show_all: 'true'), class: 'c-btn c-btn--ghost' %>
  </div>
</div>
<!-- Table -- Sortable  -->
