<%= component 'common/hero', title: 'Minu arved' %>
<!-- Table -->
<div class="o-container">
  
  <div class="c-block" data-controller='table--tab' data-table--tab-active-class='is-active'>
    <h2 class="c-block__title u-flex u-content-sp u-flex-gap-12 u-h3">Tasumata arved</h2>
    <div class="c-tabs">
      <div class="c-tabs__nav">
        <button class="c-tabs__nav__btn js-tab-btn is-active" data-table--tab-target='tab' data-action="click->table--tab#showTab" data-table--tab-index-param='0'>
          Issued invoices <sup>(<%= @issued_invoices.count %>)</sup>
        </button>
        <button class="c-tabs__nav__btn js-tab-btn" data-table--tab-target='tab' data-action="click->table--tab#showTab" data-table--tab-index-param='1'>
          Cancelled payable invoices <sup>(<%= @cancelled_payable_invoices.count %>)</sup>
        </button>
        <button class="c-tabs__nav__btn js-tab-btn" data-table--tab-target='tab' data-action="click->table--tab#showTab" data-table--tab-index-param='2'>
          Cancelled expired invoices <sup>(<%= @cancelled_expired_invoices.count %>)</sup>
        </button>

        <%= tag.div class: 'c-tabs__nav__btn--ind' do %>
          <%= button_to pay_all_bills_invoices_path, method: :post, style: 'background-color: inherit; color: inherit; text-decoration: none; border: none; box-shadow: none;' do %>
            Tasu kõik <span class="u-hidden-m">maksmata arved</span> <sup>(<%= @unpaid_invoices_count %>)</sup>
          <% end %>
        <% end if @unpaid_invoices_count.positive?%>

      </div>
      <div class="c-tabs__content">
        <div class="c-tabs__content__tab is-active" data-table--tab-target='content'>
          <div class="c-table--responsive">
            <!-- 
              These parameters are passed to the Common::Table::Component. These parameters are used to generate headers in the table component. The name "column_name" indicates the name of the column. This is necessary for sorting, so the name of this column should correspond to the name of the column in the database table. If you want to make it so that the data is not sorted by the column, then you should add a nil value. "Caption" is the table header, and "options" are additional parameters that are passed into the tags. 
            -->

            <!-- NB! if you want make columns as sortable, don't forget to wrap the table content within the turbo_frame_tag with the name "results". The name "results" is assigned as a value for the orderable Stimulus controller in the table component. -->
            <% header_collection = [{ column: nil, caption: t('invoices.item'), options: { class: "" } },
                                              { column: nil, caption: t('invoices.due_date'), options: { class: "" } },
                                              { column: nil, caption: t('invoices.total'), options: { class: "" } },
                                              { column: nil, caption: 'Tegevused', options: { class: "u-text-center-l" } },
                                              ] %>
            <!-- Options attributes are used as table attributes -->
            <%= component 'common/table', header_collection:, options: { class: '' } do %>
              <!-- "The body of the table also needs to be in the component block, so the component wraps it with the necessary tags." -->
              <% @issued_invoices.each do |invoice| %>
                <tr>
                  <td><strong><%= invoice&.items&.first&.name %></strong></td>
                  <td><%= I18n.l(invoice.due_date) %></td>
                  <td><%= t('offers.price_in_currency', price: invoice.total) %></td>
                  <td class="u-text-center-l"><%= link_to 'Tasu arve', invoice_path(invoice.uuid), class: "c-btn c-btn--green", title: "Invoice", data: { turbo_frame: 'modal' } %></td>
                </tr>
              <% end %>
            <% end %>
          </div>
        </div>
        <div class="c-tabs__content__tab" data-table--tab-target='content'>
          <div class="c-table--responsive">
            <% header_collection = [{ column: nil, caption: t('invoices.item'), options: { class: "" } },
                                              { column: nil, caption: t('invoices.due_date'), options: { class: "" } },
                                              { column: nil, caption: t('invoices.total'), options: { class: "" } },
                                              { column: nil, caption: 'Tegevused', options: { class: "u-text-center-l" } },
                                              ] %>
            <%= component 'common/table', header_collection:, options: { class: '' } do %>
              <% @cancelled_payable_invoices.each do |invoice| %>
                <tr>
                  <td><strong><%= invoice&.items&.first&.name %></strong></td>
                  <td><%= I18n.l(invoice.due_date) %></td>
                  <td><%= t('offers.price_in_currency', price: invoice.total) %></td>
                  <td class="u-text-center-l"><%= link_to 'Tasu arve', invoice_path(invoice.uuid), class: "c-btn c-btn--green", title: "Invoice", data: { turbo_frame: 'modal' } %></td>
                </tr>
              <% end %>
            <% end %>
          </div>
        </div>
        <div class="c-tabs__content__tab" data-table--tab-target='content'>
          <div class="c-table--responsive">
            <% header_collection = [{ column: nil, caption: t('invoices.item'), options: { class: "" } },
                                              { column: nil, caption: t('invoices.due_date'), options: { class: "" } },
                                              { column: nil, caption: t('invoices.total'), options: { class: "" } },
                                              { column: nil, caption: 'Tegevused', options: { class: "u-text-center-l" } },
                                              ] %>
            <%= component 'common/table', header_collection:, options: { class: '' } do %>
              <% @cancelled_expired_invoices.each do |invoice| %>
                <tr>
                  <td><strong><%= invoice&.items&.first&.name %></strong></td>
                  <td><%= I18n.l(invoice.due_date) %></td>
                  <td><%= t('offers.price_in_currency', price: invoice.total) %></td>
                  <td class="u-text-center-l"><%= link_to 'Vaata arvet', invoice_path(invoice.uuid), class: "c-btn c-btn--ghost js-modal-toggle", title: "Invoice", data: { turbo_frame: 'modal' } %></td>
                </tr>
              <% end %>
            <% end %>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="c-block" data-controller='table--tab' data-table--tab-active-class='is-active'>
    <h2 class="c-block__title u-flex u-content-sp u-flex-gap-12 u-h3">Tasutud arved</h2>
    <div class="c-tabs">
      <div class="c-tabs__nav">
        <button class="c-tabs__nav__btn js-tab-btn is-active" data-table--tab-target='tab' data-action="click->table--tab#showTab" data-table--tab-index-param='0'>
          Paid invoices <sup>(<%= @paid_invoices.count %>)</sup>
        </button>
        <button class="c-tabs__nav__btn js-tab-btn" data-table--tab-target='tab' data-action="click->table--tab#showTab" data-table--tab-index-param='1'>
          Deposit paid <sup>(<%= @deposit_paid.count %>)</sup>
        </button>

        <%= tag.div class: 'c-tabs__nav__btn--ind' do %>
          <%= button_to pay_all_bills_invoices_path, method: :post, style: 'background-color: inherit; color: inherit; text-decoration: none; border: none; box-shadow: none;' do %>
            Tasu kõik <span class="u-hidden-m">maksmata arved</span> <sup>(<%= @unpaid_invoices_count %>)</sup>
          <% end %>
        <% end if @unpaid_invoices_count.positive?%>

      </div>

      <div class="c-tabs__content">
        <div class="c-tabs__content__tab is-active" data-table--tab-target='content'>
          <div class="c-table--responsive">
            <% header_collection = [{ column: nil, caption: t('invoices.item'), options: { class: "" } },
                                              { column: nil, caption: t('invoices.due_date'), options: { class: "" } },
                                              { column: nil, caption: t('invoices.total'), options: { class: "" } },
                                              { column: nil, caption: 'Tegevused', options: { class: "u-text-center-l" } },
                                              ] %>
            <%= component 'common/table', header_collection:, options: { class: '' } do %>
              <% @paid_invoices.each do |invoice| %>
                <tr class="invoices-table-row">
                  <td><strong><%= invoice&.items&.first&.name %></strong></td>
                  <td><%= I18n.l(invoice.due_date) %></td>
                  <td><%= invoice.total %></td>
                  <td><%= link_to 'Vaata arvet', invoice_path(invoice.uuid), class: "c-btn c-btn--ghost js-modal-toggle", title: "Invoice", data: { turbo_frame: 'modal' } %></td>
                </tr>
              <% end %>
            <% end %>
          </div>
        </div>

        <div class="c-tabs__content__tab" data-table--tab-target='content'>
          <div class="c-table--responsive">
            <% header_collection = [{ column: nil, caption: t('invoices.paid_deposit.date'), options: { class: "" } },
                                              { column: nil, caption: t('invoices.paid_deposit.sum'), options: { class: "" } },
                                              { column: nil, caption: t('invoices.paid_deposit.auction_name'), options: { class: "" } },
                                              { column: nil, caption: t('invoices.paid_deposit.status'), options: { class: "" } },
                                              { column: nil, caption: t('invoices.paid_deposit.refund_time'), options: { class: "" } }
                                              ] %>
            <%= component 'common/table', header_collection:, options: { class: '' } do %>
              <% @deposit_paid.each do |deposit| %>
                <tr class="invoices-table-row">
                  <td><%= deposit.created_at.strftime("%Y-%m-%d") %></td>
                  <td><%= deposit.auction.deposit %></td>
                  <td><strong><%= deposit.auction.domain_name %></strong></td>
                  <td><%= component 'common/badgets', status: deposit.status %> <%#= t("invoices.paid_deposit.#{deposit.status}") %></td>
                  <td><%= deposit.refund_time %></td>
                </tr>
              <% end %>
            <% end %>
          </div>
        </div>

      </div>
    </div>
  </div>
</div>
